#include <hidef.h> 
#include<stdio.h>     /* common defines and macros */
#include "derivative.h"      /* derivative-specific definitions */
#include "LCD.h"

#define delay(d); for (delay = d/2; delay != 0; delay--) asm NOP;

unsigned int delay; 

char temp[20];
char pis[3];
int acp;

void pidr(int a) 
{
int i = 0;
  
  
  while(a > 0) 
  {
    
    temp[3-i-1] = a%10 + 0x30;
    a = a/10;
    
    
    i++;
  }
  
}         

void main(void) {
  /* put your own code here */
   
   LCDInit();
   LCDClearDisplay();
    DDRB = 0xF0;			//	????????? ????? ????? ??????? ????? ?? ????, ??????? ?? ?????
  	PUCR |= 0x02;			// 	????????? ????????????? ????????? ? ????? ?
  	PORTB = 0xF0;			// 	?????????? ????????

  	ATDCTL2 |= 0x82; //	????????? ??? ? ?????????? ?? ?????????? ??? ??????????????. 

  	delay(50); // 	???????? ? 50 ???. ?????????? ??? ????, ????? ?????????? ?????????? ??? ?????? ? ??????? ????????? ????? ??? ?????????. 

  	//	????????? ?????????? ?????????????? ? ?????? ?????????????????? ?????? ???????
  	//	??? ??????????, ????? ?????? ?????????? ????????? ???????????
  	ATDCTL3 = 0b00000011;			//	????????? ??????? ???????????? (fclock/2 = 2???) ? 8-??????? ?????????? ???
  	ATDCTL4 |= 0x80;		//	????? ? ???????? ????? ??????????? ????? ????? 5 ????? AD. 
  	//	????????? ?????????????? ?????? ?????? ? ???????????? ???????????? ??? ?????????? ?????.  
  	ATDCTL5 = 0x05; 
    
   
        

	EnableInterrupts;


  for(;;) {
    _FEED_COP(); /* feeds the dog */
  } /* loop forever */
  /* please make sure that you never leave main */
  
  
}
  interrupt 22 void ATD0() //	??????? ??????????
  {

   //LCDCursorAtHome();
     acp = ATDDR0H;
    
   // pidr(ATDDR0H);
   (void)sprintf(temp,"%d",acp); 
    // temp = (char/*) ATDDR0H;
    

  /* 
   pis[0] = temp[0];
   pis[1] = temp[1];
   pis[2] = temp[2];
   */
   LCDCursorAtHome();
   
   LCDPutString(temp);
   
   //delay(300000);
    
   /*for(int j = 0; j < 5; j++)
    temp[j] = '';
     */
     
	ATDCTL5 = 0x05; 	// 	????????????? ?????? ??????
}
  
